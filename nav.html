<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PYTHON教學</title>

    <script 
    type="module" 
    src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js">
  </script>
    <script 
    nomodule 
    src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js">
  </script>
  <link 
  rel="stylesheet" 
  href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css" />

  <link rel="stylesheet" href="theme.css" />
  <link rel="stylesheet" href="common.css"/>
  <link rel="stylesheet" href="style.css"/>


  </head>

  <body>
    <ion-app>
      <ion-nav root="page-one"></ion-nav>
    </ion-app>
    
    <script>
      // 課程資料
      const courseItems = [
        {
          id: 1,
          title: "Python 基礎",
          level: "入門",
          domain: "基礎",
          description: "介紹python基本知識，輸出、變數、數字的四則運算、輸入的用法。",
          tags: ["基礎語法", "數據類型", "操作符"],
          imageUrl: "src/Pic-01.png",
          videoUrl: "https://www.youtube.com/embed/cJ_yQb5rmR8?si=BBKewo2LCCpTYQAr"
        },
        {
          id: 2,
          title: "控制結構",
          level: "入門",
          domain: "基礎",
          description: "介紹python基本知識，資料型態、bool, list, 型態轉換、if表達式、for迴圈處理、while迴圈處理的用法。",
          tags: ["基礎語法", "if,elif,else 語句", "for 迴圈", "while 迴圈","book"],
          imageUrl: "src/Pic-02.png",
          videoUrl: "https://www.youtube.com/embed/winKwQwqt5c?si=YhpPNxrWa9ySD7kT"
        },
        {
          id: 3,
          title: "函數和模組",
          level: "入門",
          domain: "基礎",
          description: "了解如何定義和調用函數，並學習如何使用和創建模組來提高程式的可重用性。",
          tags: ["基礎語法", "函數定義", "模組導入", "代碼重用"],
          imageUrl: "src/Pic-03.png",
          videoUrl: "https://www.youtube.com/embed/FzLjrHDjAz4?si=2dW_Y53gMPOjF5zH"
        },
        {
          id: 4,
          title: "資料結構",
          level: "中級",
          domain: "基礎",
          description: "深入學習 Python 的資料結構，包括列表、元組、集合和字典的使用。",
          tags: ["基礎語法", "列表", "元組", "集合", "字典"],
          imageUrl: "src/Pic-04.png",
          videoUrl: "https://www.youtube.com/embed/3-pVZTczaBA?si=skx8sSIbQQEb78zp"
        },
        {
          id: 5,
          title: "文件操作",
          level: "中級",
          domain: "基礎",
          description: "學習如何讀取、寫入和處理文件，以管理資料和持久化數據。",
          tags: ["數據處理", "文件讀取", "文件寫入", "數據持久化"],
          imageUrl: "src/Pic-05.png",
          videoUrl: "https://www.youtube.com/embed/uYkGAg9iBmo?si=2GZWFkG9JXelKkrc"
        },
        {
          id: 6,
          title: "錯誤和異常處理",
          level: "中級",
          domain: "基礎",
          description: "介紹如何使用 try-except 語句來捕捉和處理異常，以提高程式的穩定性。",
          tags: ["測試與調試", "try-except", "異常捕捉", "錯誤處理"],
          imageUrl: "src/Pic-06.png",
          videoUrl: "https://www.youtube.com/embed/hpQz-0q5uGY?si=QWavOc4iKWpmH-ql"
        },
        {
          id: 7,
          title: "物件導向編程",
          level: "中級",
          domain: "基礎",
          description: "理解物件導向編程的核心概念，包括類和對象、繼承和多態。",
          tags: ["基礎語法", "類和對象", "繼承", "多態", "封裝"],
          imageUrl: "src/Pic-07.png",
          videoUrl: "https://www.youtube.com/embed/LQZLeYQEzkM?si=5JTvdCmnd0i1hA9Q"
        },
        {
          id: 8,
          title: "標準庫和第三方庫",
          level: "中級",
          domain: "基礎",
          description: "學習如何使用 Python 標準庫以及安裝和使用第三方庫來擴展應用功能。",
          tags: ["基礎語法", "標準庫", "pip", "第三方庫", "套件管理"],
          imageUrl: "src/Pic-08.png",
          videoUrl: "https://www.youtube.com/embed/2oCFSBlJ-PA?si=RqayK_a8GG46jrM3"
        },
        {
          id: 9,
          title: "正則表達式",
          level: "中級",
          domain: "數據",
          description: "掌握正則表達式的使用，以便進行模式匹配和文本處理。",
          tags: ["數據處理", "模式匹配", "文本處理", "re 模組"],
          imageUrl: "src/Pic-09.png",
          videoUrl: "https://www.youtube.com/embed/CpW8sLapu1g?si=jwpev0S6vSB2gPQ3"
        },
        {
          id: 10,
          title: "網絡編程",
          level: "中級",
          domain: "網頁",
          description: "介紹如何利用 Python 進行網絡請求、REST API 操作和數據抓取。",
          tags: ["網頁開發", "HTTP 請求", "REST API", "requests 庫"],
          imageUrl: "src/Pic-10.png",
          videoUrl: "https://www.youtube.com/embed/sUzR3QVBKIo?si=gnq5d6fZDmo8_jZ4"
        },
        {
          id: 11,
          title: "數據分析基礎",
          level: "中級",
          domain: "數據",
          description: "使用 Pandas 進行數據處理、分析及處理大數據的基礎。",
          tags: ["數據處理", "Pandas", "數據分析"],
          imageUrl: "src/Pic-11.png",
          videoUrl: "https://www.youtube.com/embed/UCeeS95GatA?si=WS2qkz3fmeQDWXEX"
        },
        {
          id: 12,
          title: "數據可視化",
          level: "中級",
          domain: "數據",
          description: "學習如何使用 Matplotlib 和 Seaborn 進行數據可視化，幫助理解數據。",
          tags: ["數據處理", "Matplotlib", "Seaborn", "圖表繪製"],
          imageUrl: "src/Pic-12.png",
          videoUrl: "https://www.youtube.com/embed/a9UrKTVEeZA?si=G_SXoNay00P0_nZr"
        },
        {
          id: 13,
          title: "Web 開發基礎",
          level: "中級",
          domain: "網頁",
          description: "使用 Flask 或 Django 框架建立簡單的 web 應用程序，了解後端開發。",
          tags: ["網頁開發", "Flask", "Django", "後端開發"],
          imageUrl: "src/Pic-13.png",
          videoUrl: "https://www.youtube.com/embed/Z1RJmh_OqeA?si=Aw53cHRq1_ZFatBp"
        },
        {
          id: 14,
          title: "測試和調試",
          level: "中級",
          domain: "基礎",
          description: "學習如何使用單元測試和調試工具，保證代碼質量和可靠性。",
          tags: ["測試與調試", "單元測試", "unittest", "調試技巧"],
          imageUrl: "src/Pic-14.png",
          videoUrl: "https://www.youtube.com/embed/s83zs3wLOEo?si=Vt1dCesLnYMfRn8F"
        },
        {
          id: 15,
          title: "API 開發",
          level: "進階",
          domain: "網頁",
          description: "學習如何使用 Flask-Restful 開發 RESTful API，並與前端交互。",
          tags: ["網頁開發", "RESTful API", "Flask-RESTful"],
          imageUrl: "src/Pic-15.png",
          videoUrl: "https://www.youtube.com/embed/KjQXByQLMyE?si=uQ1XCxC6LH7LmgJo"
        },
        {
          id: 16,
          title: "機器學習基礎",
          level: "進階",
          domain: "人工智能",
          description: "全面理解機器學習的原理，利用機器學習作分析、預測，並使用pytorch搭建模型。",
          tags: ["人工智能", "pytorch", "模型訓練", "預測分析"],
          imageUrl: "src/Pic-16.png",
          videoUrl: "https://www.youtube.com/embed/wm9yR1VspPs?si=eUlKfWqBjx3ga7Ma"
        },
        {
          id: 17,
          title: "自然語言處理",
          level: "進階",
          domain: "人工智能",
          description: "處理真實數據時可能遇到的挑戰和解決方案。透過這個影片，您將獲得對NLP專案的全面理解，並掌握建立有效NLP應用的基本技能。",
          tags: ["人工智能", "NLTK", "SpaCy", "文本分析"],
          imageUrl: "src/Pic-17.png",
          videoUrl: "https://www.youtube.com/embed/h2kBNEShsiE?si=IG1OjLUsa5yJwY2m"
        },
        {
          id: 18,
          title: "電腦應用程式開發",
          level: "中級",
          domain: "中級",
          description: "使用 Tkinter 開發簡單的桌面應用程序，掌握 GUI 編程基礎。",
          tags: ["基礎語法", "Tkinter", "GUI 編程", "桌面應用"],
          imageUrl: "src/Pic-18.png",
          videoUrl: "https://www.youtube.com/embed/IXQWVM46-zg?si=tNyIPVTADvw-nTgT"
        },
        {
          id: 19,
          title: "爬蟲技術",
          level: "中級",
          domain: "數據",
          description: "學習使用Scrapy 進行網頁爬蟲，提取網頁數據。",
          tags: ["數據處理",  "Scrapy", "網頁數據提取"],
          imageUrl: "src/Pic-19.png",
          videoUrl: "https://www.youtube.com/embed/u-1PURwCMxE?si=Ta2-2W1ML_-vp8Hf"
        },
        {
          id: 20,
          title: "數據庫操作",
          level: "中級",
          domain: "數據",
          description: "使用 SQL、MySQL 和資料庫管理相關的基本概念和實用技能。",
          tags: ["數據處理", "SQLite", "SQLAlchemy", "CRUD 操作"],
          imageUrl: "src/Pic-20.png",
          videoUrl: "https://www.youtube.com/embed/gvRXjsrpCHw?si=wxSDfItoSpG8oPld"
        }
      ];

      // Global functions for video modal and favorites
      function getFavoriteCourses() {
        return JSON.parse(localStorage.getItem('favoriteCourses')) || [];
      }
      
      function isFavorite(courseId) {
        const favorites = getFavoriteCourses();
        return favorites.some(course => course.id === courseId);
      }
      
      function addToFavorites(course) {
        let favorites = getFavoriteCourses();
        
        if (!favorites.some(item => item.id === course.id)) {
          favorites.push(course);
          localStorage.setItem('favoriteCourses', JSON.stringify(favorites));
          
          showToast('課程已加入收藏');
          return true;
        }
        return false;
      }
      
      function removeFromFavorites(courseId) {
        let favorites = getFavoriteCourses();
        const newFavorites = favorites.filter(course => course.id !== courseId);
        
        if (newFavorites.length !== favorites.length) {
          localStorage.setItem('favoriteCourses', JSON.stringify(newFavorites));
          
          showToast('課程已從收藏中移除');
          return true;
        }
        return false;
      }
      
      function showToast(message) {
        const toast = document.createElement('ion-toast');
        toast.message = message;
        toast.duration = 2000;
        toast.position = 'bottom';
        document.body.appendChild(toast);
        toast.present();
      }
      
      function toggleFavorite(event, course) {
        event.stopPropagation();
        
        const button = event.currentTarget;
        const isFav = button.classList.contains('active');
        
        if (isFav) {
          if (removeFromFavorites(course.id)) {
            button.classList.remove('active');
            button.querySelector('ion-icon').setAttribute('name', 'heart-outline');
          }
        } else {
          if (addToFavorites(course)) {
            button.classList.add('active');
            button.querySelector('ion-icon').setAttribute('name', 'heart');
          }
        }
      }
      
      function openVideoModal(videoUrl, title) {
        const videoModal = document.querySelector('#video-modal');
        const videoTitle = document.querySelector('#video-title');
        const videoContainer = document.querySelector('#video-container');
        
        videoTitle.textContent = title + ' - 影片播放';
        videoContainer.innerHTML = `
          <iframe class="modal-video" src="${videoUrl}" 
            frameborder="0" allowfullscreen></iframe>
        `;
        videoModal.present();
      }
      
      function filterByTag(tag) {
        const pageTwoInstance = document.querySelector('page-two');
        if (pageTwoInstance) {
          pageTwoInstance.filterByTag(tag);
        }
      }
      
      function resetAllFilters() {
        const pageTwoInstance = document.querySelector('page-two');
        if (pageTwoInstance) {
          pageTwoInstance.resetAllFilters();
        }
      }
      
      // Chat functions for page four
      function getCurrentTime() {
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const ampm = hours >= 12 ? 'PM' : 'AM';
        const formattedHours = hours % 12 || 12;
        const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
        return `${formattedHours}:${formattedMinutes} ${ampm}`;
      }
      
      function addMessage(text, isUser = true) {
        const messagesContainer = document.querySelector('#messages-container');
        if (!messagesContainer) return;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user-message' : 'admin-message'}`;
        messageDiv.innerHTML = `
          ${text}
          <div class="message-time">${getCurrentTime()}</div>
        `;
        
        messagesContainer.appendChild(messageDiv);
        
        // Scroll to the bottom
        const content = document.querySelector('ion-content');
        content.scrollToBottom(300);
      }
      
      function showTypingIndicator() {
        const typingIndicator = document.querySelector('#typing-indicator');
        if (typingIndicator) {
          typingIndicator.classList.add('active');
        }
      }
      
      function hideTypingIndicator() {
        const typingIndicator = document.querySelector('#typing-indicator');
        if (typingIndicator) {
          typingIndicator.classList.remove('active');
        }
      }
      
      function simulateAdminResponse(userMessage) {
        showTypingIndicator();
        
        let response = '';
        const lowerMessage = userMessage.toLowerCase();
        
        // Simulate thinking time
        const thinkingTime = 1000 + Math.random() * 2000;
        
        setTimeout(() => {
          hideTypingIndicator();
          
          if (lowerMessage.includes('你好') || lowerMessage.includes('HI') || lowerMessage.includes('hi') || lowerMessage.includes('hello')) {
            response = '您好！請問有什麼可以幫到您嗎？';
          } else if (lowerMessage.includes('課程') || lowerMessage.includes('class')) {
            response = '我們只提供從網上得到的資源分享 Python 課程，您可以在「All Classes」頁面查看所有課程。';
          } else {
            response = '感謝您的訊息！我們的團隊將盡快處理您的問題。如果您有更多問題，請隨時告訴我。';
          }
          
          addMessage(response, false);
        }, thinkingTime);
      }
      
      function sendChatMessage() {
        const messageInput = document.querySelector('#message-input');
        if (!messageInput) return;
        
        const message = messageInput.value.trim();
        
        if (message) {
          // Add user message to chat
          addMessage(message, true);
          
          // Clear input
          messageInput.value = '';
          
          // Simulate admin response
          simulateAdminResponse(message);
        }
      }
      
      // Make functions available globally
      window.openVideoModal = openVideoModal;
      window.filterByTag = filterByTag;
      window.resetAllFilters = resetAllFilters;
      window.toggleFavorite = toggleFavorite;
      window.sendChatMessage = sendChatMessage;

      class PageOne extends HTMLElement {
        connectedCallback() {
          this.innerHTML = `
            <ion-header>
              <ion-toolbar color="primary">
                <ion-title style="color: white; font-weight: bold;">Python 課程教學</ion-title>
              </ion-toolbar>
            </ion-header>

            <ion-content>
              <div class="menu-container">
                <div class="logo-container">
                  <img src="src/logo.png" alt="Python 學習平台 Logo" class="logo">
                </div>
                <p class="menu-instruction">歡迎來到小小的教學平台，請選擇以下清單:</p>

                <!--選擇清單-->
                <!--First list-->
                <ion-nav-link router-direction="forward" component="page-two">
                  <ion-button expand="block" class="menu-button">
                    <ion-icon name="book-outline" slot="start"></ion-icon>
                    所有課程
                  </ion-button>
                </ion-nav-link>

                <!--Second List-->
                <ion-nav-link router-direction="forward" component="page-three">
                  <ion-button expand="block" class="menu-button">
                    <ion-icon name="bookmark-outline" slot="start"></ion-icon>
                    我的收藏
                  </ion-button>
                </ion-nav-link>
                
                <!--Third List-->
                <ion-nav-link router-direction="forward" component="page-four">
                  <ion-button expand="block" class="menu-button">
                    <ion-icon name="chatbubbles-outline" slot="start"></ion-icon>
                    與管理員聯絡
                  </ion-button>
                </ion-nav-link>
              </div>
            </ion-content>
          `;
        }
      }

      class PageTwo extends HTMLElement {
        constructor() {
          super();
          this.currentFilters = {
            searchTerm: '',
            level: '',
            domain: '',
            tag: ''
          };
        }
        
        connectedCallback() {
          this.innerHTML = `
            <ion-header>
              <ion-toolbar color="primary">
                <ion-buttons slot="start">
                  <ion-back-button></ion-back-button>
                </ion-buttons>
                <ion-title style="color: white; font-weight: bold;">Python 課程教學</ion-title>
              </ion-toolbar>
              
             <!--搜尋功能-->
              <ion-searchbar
                id="search-bar"
                placeholder="搜尋..."
              ></ion-searchbar>
              
              <!--分類程度功能-->
              <ion-toolbar>
                <div class="filter-container">
                  <div class="filter-group">
                    <div class="filter-label">程度:</div>
                    <ion-select placeholder="選擇程度" id="level-select" interface="popover">
                      <ion-select-option value="">全部</ion-select-option>
                      <ion-select-option value="入門">入門</ion-select-option>
                      <ion-select-option value="中級">中級</ion-select-option>
                      <ion-select-option value="進階">進階</ion-select-option>
                    </ion-select>
                  </div>
                  
                  <!--分類課程功能-->    
                  <div class="filter-group">
                    <div class="filter-label">課程:</div>
                    <ion-select placeholder="選擇課程" id="domain-select" interface="popover">
                      <ion-select-option value="">全部</ion-select-option>
                      <ion-select-option value="基礎">基礎程式設計</ion-select-option>
                      <ion-select-option value="數據">數據分析與處理</ion-select-option>
                      <ion-select-option value="網頁">網頁與API開發</ion-select-option>
                      <ion-select-option value="人工智能">人工智能與機器學習</ion-select-option>
                    </ion-select>
                  </div>
                  
                  <!--refresh功能-->    
                  <ion-button size="small" id="reset-filters" fill="outline" class="reset-button">
                    <ion-icon name="refresh" size="small" slot="start"></ion-icon>
                  </ion-button>
                </div>
                
                <div class="filter-chips">
                  <ion-chip outline id="all-filter" class="active-filter">
                    <ion-label>全部</ion-label>
                  </ion-chip>
                  <ion-chip outline id="basic-filter">
                    <ion-label>基礎語法</ion-label>
                  </ion-chip>
                  <ion-chip outline id="data-filter">
                    <ion-label>數據處理</ion-label>
                  </ion-chip>
                  <ion-chip outline id="web-filter">
                    <ion-label>網頁開發</ion-label>
                  </ion-chip>
                  <ion-chip outline id="ai-filter">
                    <ion-label>人工智能</ion-label>
                  </ion-chip>
                  <ion-chip outline id="testing-filter">
                    <ion-label>測試</ion-label>
                  </ion-chip>
                </div>
              </ion-toolbar>
            </ion-header>
            
            <ion-content>
              <ion-list id="course-list">
                <!-- 課程項目將由 JavaScript 動態生成 -->
              </ion-list>
            </ion-content>
            
            <!-- 影片播放 Modal -->
            <ion-modal id="video-modal">
              <ion-header>
                <ion-toolbar>
                  <ion-title id="video-title">影片播放</ion-title>
                  <ion-buttons slot="end">
                    <ion-button id="close-modal">關閉</ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-header>
              <ion-content>
                <div id="video-container" class="ion-padding">
                  <!-- 影片將在這裡顯示 -->
                </div>
              </ion-content>
            </ion-modal>
          `;
          
          // Initialize the page after it's added to the DOM
          setTimeout(() => this.initializePage(), 0);
        }
        
        initializePage() {
          // Get DOM elements
          this.courseList = this.querySelector('#course-list');
          this.searchBar = this.querySelector('#search-bar');
          this.levelSelect = this.querySelector('#level-select');
          this.domainSelect = this.querySelector('#domain-select');
          this.resetFiltersBtn = this.querySelector('#reset-filters');
          this.videoModal = this.querySelector('#video-modal');
          this.closeModalBtn = this.querySelector('#close-modal');
          
          // Filter chips
          this.allFilter = this.querySelector('#all-filter');
          this.basicFilter = this.querySelector('#basic-filter');
          this.dataFilter = this.querySelector('#data-filter');
          this.webFilter = this.querySelector('#web-filter');
          this.aiFilter = this.querySelector('#ai-filter');
          this.testingFilter = this.querySelector('#testing-filter');
          
          // Add event listeners
          this.searchBar.addEventListener('ionInput', (event) => {
            this.currentFilters.searchTerm = event.target.value || '';
            this.updateList();
          });
          
          this.levelSelect.addEventListener('ionChange', (event) => {
            this.currentFilters.level = event.detail.value || '';
            this.updateList();
          });
          
          this.domainSelect.addEventListener('ionChange', (event) => {
            this.currentFilters.domain = event.detail.value || '';
            this.updateList();
          });
          
          this.resetFiltersBtn.addEventListener('click', () => {
            this.resetAllFilters();
          });
          
          this.closeModalBtn.addEventListener('click', () => {
            this.videoModal.dismiss();
            const videoContainer = this.querySelector('#video-container');
            videoContainer.innerHTML = '';
          });
          
          // Filter chip event listeners
          this.allFilter.addEventListener('click', () => {
            this.currentFilters.tag = '';
            this.updateList();
          });
          
          this.basicFilter.addEventListener('click', () => this.filterByTag('基礎語法'));
          this.dataFilter.addEventListener('click', () => this.filterByTag('數據處理'));
          this.webFilter.addEventListener('click', () => this.filterByTag('網頁開發'));
          this.aiFilter.addEventListener('click', () => this.filterByTag('人工智能'));
          this.testingFilter.addEventListener('click', () => this.filterByTag('測試與調試'));
          
          // Initialize the list
          this.updateList();
        }
        
        filterByTag(tag) {
          if (this.currentFilters.tag === tag) {
            this.currentFilters.tag = '';
          } else {
            this.currentFilters.tag = tag;
          }
          this.updateList();
        }
        
        resetAllFilters() {
          this.currentFilters = {
            searchTerm: '',
            level: '',
            domain: '',
            tag: ''
          };
          
          // Reset UI elements
          this.searchBar.value = '';
          this.levelSelect.value = '';
          this.domainSelect.value = '';
          
          this.updateList();
        }
        
        updateFilterUI() {
          // Update tag filter UI
          const allChips = this.querySelectorAll('.filter-chips ion-chip');
          allChips.forEach(chip => {
            chip.classList.remove('active-filter');
          });
          
          if (this.currentFilters.tag === '') {
            this.allFilter.classList.add('active-filter');
          } else {
            switch(this.currentFilters.tag) {
              case '基礎語法':
                this.basicFilter.classList.add('active-filter');
                break;
              case '數據處理':
                this.dataFilter.classList.add('active-filter');
                break;
              case '網頁開發':
                this.webFilter.classList.add('active-filter');
                break;
              case '人工智能':
                this.aiFilter.classList.add('active-filter');
                break;
              case '測試與調試':
                this.testingFilter.classList.add('active-filter');
                break;
            }
          }
        }
        
        updateList() {
          if (!this.courseList) return;
          
          this.courseList.innerHTML = '';
          
          // Get filter conditions
          const searchTerm = this.currentFilters.searchTerm.toLowerCase();
          const selectedLevel = this.currentFilters.level;
          const selectedDomain = this.currentFilters.domain;
          const selectedTag = this.currentFilters.tag;
          
          // Filter courses
          let filteredCourses = courseItems.filter(item => {
            // Search condition
            const matchesSearch = searchTerm === '' || 
              item.title.toLowerCase().includes(searchTerm) || 
              item.description.toLowerCase().includes(searchTerm);
            
            // Level filter
            const matchesLevel = selectedLevel === '' || item.level.includes(selectedLevel);
            
            // Domain filter
            const matchesDomain = selectedDomain === '' || item.domain === selectedDomain;
            
            // Tag filter
            const matchesTag = selectedTag === '' || item.tags.includes(selectedTag);
            
            return matchesSearch && matchesLevel && matchesDomain && matchesTag;
          });
          
          // Display filtered courses
          if (filteredCourses.length > 0) {
            filteredCourses.forEach(item => {
              const listItem = document.createElement('ion-item');
              const isFav = isFavorite(item.id);
              
              listItem.innerHTML = `
                <ion-card style="width: 100%;">
                  <div class="video-thumbnail">
                    <img src="${item.imageUrl}" alt="${item.title}" class="course-image">
                    <div class="play-button" onclick="openVideoModal('${item.videoUrl}', '${item.title}')">
                      <ion-icon name="play" color="light" size="large"></ion-icon>
                    </div>
                    <div class="favorite-button ${isFav ? 'active' : ''}" id="fav-btn-${item.id}">
                      <ion-icon name="${isFav ? 'heart' : 'heart-outline'}"></ion-icon>
                    </div>
                  </div>
                  <ion-card-content>
                    <div class="course-details">
                      <div class="course-title">${item.title}</div>
                      <div class="course-meta">
                        <span>程式語言: Python 3.x</span>
                        <span>程度: ${item.level}</span>
                      </div>
                      <div class="course-description">
                        ${item.description}
                      </div>
                      <div class="tag-container">
                        ${item.tags.map(tag => 
                          `<ion-chip color="${tag === selectedTag ? 'primary' : 'medium'}" 
                                    outline="${tag !== selectedTag}" 
                                    class="${tag === selectedTag ? 'active-filter' : ''}"
                                    onclick="filterByTag('${tag}')">${tag}</ion-chip>`
                        ).join('')}
                      </div>
                    </div>
                  </ion-card-content>
                </ion-card>
              `;
              
              this.courseList.appendChild(listItem);
              
              // Add favorite button event listener
              const favBtn = this.querySelector(`#fav-btn-${item.id}`);
              favBtn.addEventListener('click', (event) => toggleFavorite(event, item));
            });
          } else {
            // No matching courses, show empty state
            const emptyState = document.createElement('div');
            emptyState.className = 'empty-state';
            emptyState.innerHTML = `
              <ion-icon name="search-outline"></ion-icon>
              <h2>沒有找到符合條件的課程</h2>
              <p>請嘗試調整搜尋條件或分類篩選</p>
              <ion-button color="primary" onclick="resetAllFilters()">
                <ion-icon name="refresh" slot="end"></ion-icon>
                重設所有篩選
              </ion-button>
            `;
            this.courseList.appendChild(emptyState);
          }
          
          // Update filter UI
          this.updateFilterUI();
        }
      }

      class PageThree extends HTMLElement {
        connectedCallback() {
          this.innerHTML = `
            <ion-header>
              <ion-toolbar color="primary">
                <ion-buttons slot="start">
                  <ion-back-button></ion-back-button>
                </ion-buttons>
                <ion-title style="color: white; font-weight: bold;">我的收藏</ion-title>
              </ion-toolbar>

              <!--搜尋功能-->
              <ion-searchbar
                id="search-bar"
                placeholder="搜尋收藏課程..."
              ></ion-searchbar>
            </ion-header>
            
            <ion-content>
              <div class="header-note">
                <ion-icon name="heart"></ion-icon> 這裡顯示您收藏的所有課程
              </div>
              
              <ion-list id="favorites-list">
                <!-- 收藏課程將由 JavaScript 動態生成 -->
              </ion-list>
            </ion-content>
            
            <!-- 影片播放 Modal -->
            <ion-modal id="video-modal">
              <ion-header>
                <ion-toolbar>
                  <ion-title id="video-title">影片播放</ion-title>
                  <ion-buttons slot="end">
                    <ion-button id="close-modal">關閉</ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-header>
              <ion-content>
                <div id="video-container" class="ion-padding">
                  <!-- 影片將在這裡顯示 -->
                </div>
              </ion-content>
            </ion-modal>
          `;
          
          
        // Initialize favorites page
        this.initModalClose();
          setTimeout(() => this.loadFavorites(), 0);
        }

        initModalClose() {
        const closeModalBtn = this.querySelector('#close-modal');
        const videoModal = this.querySelector('#video-modal');

        // Set event listener for the close modal button
        closeModalBtn.addEventListener('click', () => {
            videoModal.dismiss(); // Close the modal
        });
    }
        
        loadFavorites() {
          const favoritesList = this.querySelector('#favorites-list');
          const favorites = getFavoriteCourses();
          
          if (favorites.length > 0) {
            favoritesList.innerHTML = '';
            
            favorites.forEach(item => {
              const listItem = document.createElement('ion-item');
              
              listItem.innerHTML = `
                <ion-card style="width: 100%;">
                  <div class="video-thumbnail">
                    <img src="${item.imageUrl}" alt="${item.title}" class="course-image">
                    <div class="play-button" onclick="openVideoModal('${item.videoUrl}', '${item.title}')">
                      <ion-icon name="play" color="light" size="large"></ion-icon>
                    </div>
                    <div class="favorite-button active" id="fav-btn-${item.id}">
                      <ion-icon name="heart"></ion-icon>
                    </div>
                  </div>
                  <ion-card-content>
                    <div class="course-details">
                      <div class="course-title">${item.title}</div>
                      <div class="course-meta">
                        <span>程式語言: Python 3.x</span>
                        <span>程度: ${item.level}</span>
                      </div>
                      <div class="course-description">
                        ${item.description}
                      </div>
                    </div>
                  </ion-card-content>
                </ion-card>
              `;
              
              favoritesList.appendChild(listItem);
              
              // Add favorite button event listener
              setTimeout(() => {
                const favBtn = this.querySelector(`#fav-btn-${item.id}`);
                favBtn.addEventListener('click', (event) => {
                  toggleFavorite(event, item);
                  // Reload favorites after removing
                  this.loadFavorites();
                });
              }, 0);
            });
          } else {
            // No favorites, show empty state
            favoritesList.innerHTML = `
              <div class="empty-state">
                <ion-icon name="heart-outline"></ion-icon>
                <h2>您還沒有收藏任何課程</h2>
                <p>在課程頁面點擊心形圖標來收藏您喜歡的課程</p>
                <ion-nav-link router-direction="forward" component="page-two">
                  <ion-button color="primary">
                    <ion-icon name="list" slot="start"></ion-icon>
                    瀏覽所有課程
                  </ion-button>
                </ion-nav-link>
              </div>
            `;
          }
        }
      }
      
      class PageFour extends HTMLElement {
        connectedCallback() {
          this.innerHTML = `
            <ion-header>
              <ion-toolbar color="primary">
                <ion-buttons slot="start">
                  <ion-back-button></ion-back-button>
                </ion-buttons>
                <ion-title style="color: white; font-weight: bold;">聯絡管理員</ion-title>
              </ion-toolbar>
            </ion-header>

            <ion-content>
              <div class="chat-container">
                <div class="admin-info">
                  <div class="admin-avatar">管</div>
                  <div>
                    <div><strong>管理員-P仔</strong></div>
                    <div class="admin-status">下線 • 通常在幾分鐘內回覆</div>
                  </div>
                </div>
                
                <div id="messages-container">
                  <div class="message admin-message">
                    您好！我是管理員-P仔，有什麼可以幫助您的嗎？
                    <div class="message-time">10:30 AM</div>
                  </div>
                </div>
                
                <div id="typing-indicator" class="typing-indicator">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      </div>
    </ion-content>
        <ion-footer>
            <ion-item lines="none"class="border-top">
             
                <ion-textarea placeholder="輸入訊息..." id="message-input">  </ion-textarea>            
                <ion-icon name="paper-plane" class="send-button" id="send-button"></ion-icon>

              
            </ion-item> 
        </ion-footer>

          `;

          // Initialize listeners after the component is connected
          setTimeout(() => this.initializeListeners(), 0);
        }
        
        initializeListeners() {
          const sendButton = this.querySelector('#send-button');
          const messageInput = this.querySelector('#message-input');
          
          if (sendButton && messageInput) {
            sendButton.addEventListener('click', () => sendChatMessage());
            
            messageInput.addEventListener('keydown', (event) => {
              if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
              }
            });
          }
        }
      }

      // Define custom elements
      customElements.define('page-one', PageOne);
      customElements.define('page-two', PageTwo);
      customElements.define('page-three', PageThree);
      customElements.define('page-four', PageFour);
    </script>
  </body>
</html>